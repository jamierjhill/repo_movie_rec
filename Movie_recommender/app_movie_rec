{"cells":[{"cell_type":"code","execution_count":4,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"collapsed":true,"executionInfo":{"elapsed":42620,"status":"ok","timestamp":1730359993960,"user":{"displayName":"Jamie Hill","userId":"10831983047187267053"},"user_tz":0},"id":"MeNcn9x8FqqY","outputId":"0f06a039-e138-453a-b026-d711b1ce19a2"},"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting IMDbPY\n","  Downloading IMDbPY-2022.7.9-py3-none-any.whl.metadata (498 bytes)\n","Collecting cinemagoer (from IMDbPY)\n","  Downloading cinemagoer-2023.5.1-py3-none-any.whl.metadata (2.9 kB)\n","Requirement already satisfied: SQLAlchemy in /usr/local/lib/python3.10/dist-packages (from cinemagoer->IMDbPY) (2.0.36)\n","Requirement already satisfied: lxml in /usr/local/lib/python3.10/dist-packages (from cinemagoer->IMDbPY) (4.9.4)\n","Requirement already satisfied: typing-extensions>=4.6.0 in /usr/local/lib/python3.10/dist-packages (from SQLAlchemy->cinemagoer->IMDbPY) (4.12.2)\n","Requirement already satisfied: greenlet!=0.4.17 in /usr/local/lib/python3.10/dist-packages (from SQLAlchemy->cinemagoer->IMDbPY) (3.1.1)\n","Downloading IMDbPY-2022.7.9-py3-none-any.whl (1.2 kB)\n","Downloading cinemagoer-2023.5.1-py3-none-any.whl (297 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m297.2/297.2 kB\u001b[0m \u001b[31m4.6 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hInstalling collected packages: cinemagoer, IMDbPY\n","Successfully installed IMDbPY-2022.7.9 cinemagoer-2023.5.1\n","Collecting en-core-web-md==3.7.1\n","  Downloading https://github.com/explosion/spacy-models/releases/download/en_core_web_md-3.7.1/en_core_web_md-3.7.1-py3-none-any.whl (42.8 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m42.8/42.8 MB\u001b[0m \u001b[31m18.0 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: spacy<3.8.0,>=3.7.2 in /usr/local/lib/python3.10/dist-packages (from en-core-web-md==3.7.1) (3.7.5)\n","Requirement already satisfied: spacy-legacy<3.1.0,>=3.0.11 in /usr/local/lib/python3.10/dist-packages (from spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (3.0.12)\n","Requirement already satisfied: spacy-loggers<2.0.0,>=1.0.0 in /usr/local/lib/python3.10/dist-packages (from spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (1.0.5)\n","Requirement already satisfied: murmurhash<1.1.0,>=0.28.0 in /usr/local/lib/python3.10/dist-packages (from spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (1.0.10)\n","Requirement already satisfied: cymem<2.1.0,>=2.0.2 in /usr/local/lib/python3.10/dist-packages (from spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (2.0.8)\n","Requirement already satisfied: preshed<3.1.0,>=3.0.2 in /usr/local/lib/python3.10/dist-packages (from spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (3.0.9)\n","Requirement already satisfied: thinc<8.3.0,>=8.2.2 in /usr/local/lib/python3.10/dist-packages (from spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (8.2.5)\n","Requirement already satisfied: wasabi<1.2.0,>=0.9.1 in /usr/local/lib/python3.10/dist-packages (from spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (1.1.3)\n","Requirement already satisfied: srsly<3.0.0,>=2.4.3 in /usr/local/lib/python3.10/dist-packages (from spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (2.4.8)\n","Requirement already satisfied: catalogue<2.1.0,>=2.0.6 in /usr/local/lib/python3.10/dist-packages (from spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (2.0.10)\n","Requirement already satisfied: weasel<0.5.0,>=0.1.0 in /usr/local/lib/python3.10/dist-packages (from spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (0.4.1)\n","Requirement already satisfied: typer<1.0.0,>=0.3.0 in /usr/local/lib/python3.10/dist-packages (from spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (0.12.5)\n","Requirement already satisfied: tqdm<5.0.0,>=4.38.0 in /usr/local/lib/python3.10/dist-packages (from spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (4.66.5)\n","Requirement already satisfied: requests<3.0.0,>=2.13.0 in /usr/local/lib/python3.10/dist-packages (from spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (2.32.3)\n","Requirement already satisfied: pydantic!=1.8,!=1.8.1,<3.0.0,>=1.7.4 in /usr/local/lib/python3.10/dist-packages (from spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (2.9.2)\n","Requirement already satisfied: jinja2 in /usr/local/lib/python3.10/dist-packages (from spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (3.1.4)\n","Requirement already satisfied: setuptools in /usr/local/lib/python3.10/dist-packages (from spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (75.1.0)\n","Requirement already satisfied: packaging>=20.0 in /usr/local/lib/python3.10/dist-packages (from spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (24.1)\n","Requirement already satisfied: langcodes<4.0.0,>=3.2.0 in /usr/local/lib/python3.10/dist-packages (from spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (3.4.1)\n","Requirement already satisfied: numpy>=1.19.0 in /usr/local/lib/python3.10/dist-packages (from spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (1.26.4)\n","Requirement already satisfied: language-data>=1.2 in /usr/local/lib/python3.10/dist-packages (from langcodes<4.0.0,>=3.2.0->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (1.2.0)\n","Requirement already satisfied: annotated-types>=0.6.0 in /usr/local/lib/python3.10/dist-packages (from pydantic!=1.8,!=1.8.1,<3.0.0,>=1.7.4->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (0.7.0)\n","Requirement already satisfied: pydantic-core==2.23.4 in /usr/local/lib/python3.10/dist-packages (from pydantic!=1.8,!=1.8.1,<3.0.0,>=1.7.4->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (2.23.4)\n","Requirement already satisfied: typing-extensions>=4.6.1 in /usr/local/lib/python3.10/dist-packages (from pydantic!=1.8,!=1.8.1,<3.0.0,>=1.7.4->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (4.12.2)\n","Requirement already satisfied: charset-normalizer<4,>=2 in /usr/local/lib/python3.10/dist-packages (from requests<3.0.0,>=2.13.0->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (3.4.0)\n","Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.10/dist-packages (from requests<3.0.0,>=2.13.0->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (3.10)\n","Requirement already satisfied: urllib3<3,>=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests<3.0.0,>=2.13.0->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (2.2.3)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests<3.0.0,>=2.13.0->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (2024.8.30)\n","Requirement already satisfied: blis<0.8.0,>=0.7.8 in /usr/local/lib/python3.10/dist-packages (from thinc<8.3.0,>=8.2.2->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (0.7.11)\n","Requirement already satisfied: confection<1.0.0,>=0.0.1 in /usr/local/lib/python3.10/dist-packages (from thinc<8.3.0,>=8.2.2->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (0.1.5)\n","Requirement already satisfied: click>=8.0.0 in /usr/local/lib/python3.10/dist-packages (from typer<1.0.0,>=0.3.0->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (8.1.7)\n","Requirement already satisfied: shellingham>=1.3.0 in /usr/local/lib/python3.10/dist-packages (from typer<1.0.0,>=0.3.0->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (1.5.4)\n","Requirement already satisfied: rich>=10.11.0 in /usr/local/lib/python3.10/dist-packages (from typer<1.0.0,>=0.3.0->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (13.9.3)\n","Requirement already satisfied: cloudpathlib<1.0.0,>=0.7.0 in /usr/local/lib/python3.10/dist-packages (from weasel<0.5.0,>=0.1.0->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (0.20.0)\n","Requirement already satisfied: smart-open<8.0.0,>=5.2.1 in /usr/local/lib/python3.10/dist-packages (from weasel<0.5.0,>=0.1.0->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (7.0.5)\n","Requirement already satisfied: MarkupSafe>=2.0 in /usr/local/lib/python3.10/dist-packages (from jinja2->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (3.0.2)\n","Requirement already satisfied: marisa-trie>=0.7.7 in /usr/local/lib/python3.10/dist-packages (from language-data>=1.2->langcodes<4.0.0,>=3.2.0->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (1.2.1)\n","Requirement already satisfied: markdown-it-py>=2.2.0 in /usr/local/lib/python3.10/dist-packages (from rich>=10.11.0->typer<1.0.0,>=0.3.0->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (3.0.0)\n","Requirement already satisfied: pygments<3.0.0,>=2.13.0 in /usr/local/lib/python3.10/dist-packages (from rich>=10.11.0->typer<1.0.0,>=0.3.0->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (2.18.0)\n","Requirement already satisfied: wrapt in /usr/local/lib/python3.10/dist-packages (from smart-open<8.0.0,>=5.2.1->weasel<0.5.0,>=0.1.0->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (1.16.0)\n","Requirement already satisfied: mdurl~=0.1 in /usr/local/lib/python3.10/dist-packages (from markdown-it-py>=2.2.0->rich>=10.11.0->typer<1.0.0,>=0.3.0->spacy<3.8.0,>=3.7.2->en-core-web-md==3.7.1) (0.1.2)\n","Installing collected packages: en-core-web-md\n","Successfully installed en-core-web-md-3.7.1\n","\u001b[38;5;2m✔ Download and installation successful\u001b[0m\n","You can now load the package via spacy.load('en_core_web_md')\n","\u001b[38;5;3m⚠ Restart to reload dependencies\u001b[0m\n","If you are in a Jupyter or Colab notebook, you may need to restart Python in\n","order to load all the package's dependencies. You can do this by selecting the\n","'Restart kernel' or 'Restart runtime' option.\n","Requirement already satisfied: requests in /usr/local/lib/python3.10/dist-packages (2.32.3)\n","Requirement already satisfied: charset-normalizer<4,>=2 in /usr/local/lib/python3.10/dist-packages (from requests) (3.4.0)\n","Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.10/dist-packages (from requests) (3.10)\n","Requirement already satisfied: urllib3<3,>=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests) (2.2.3)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests) (2024.8.30)\n","Requirement already satisfied: flask in /usr/local/lib/python3.10/dist-packages (2.2.5)\n","Requirement already satisfied: Werkzeug>=2.2.2 in /usr/local/lib/python3.10/dist-packages (from flask) (3.0.6)\n","Requirement already satisfied: Jinja2>=3.0 in /usr/local/lib/python3.10/dist-packages (from flask) (3.1.4)\n","Requirement already satisfied: itsdangerous>=2.0 in /usr/local/lib/python3.10/dist-packages (from flask) (2.2.0)\n","Requirement already satisfied: click>=8.0 in /usr/local/lib/python3.10/dist-packages (from flask) (8.1.7)\n","Requirement already satisfied: MarkupSafe>=2.0 in /usr/local/lib/python3.10/dist-packages (from Jinja2>=3.0->flask) (3.0.2)\n","Requirement already satisfied: Flask in /usr/local/lib/python3.10/dist-packages (2.2.5)\n","Collecting flask-ngrok\n","  Downloading flask_ngrok-0.0.25-py3-none-any.whl.metadata (1.8 kB)\n","Requirement already satisfied: Werkzeug>=2.2.2 in /usr/local/lib/python3.10/dist-packages (from Flask) (3.0.6)\n","Requirement already satisfied: Jinja2>=3.0 in /usr/local/lib/python3.10/dist-packages (from Flask) (3.1.4)\n","Requirement already satisfied: itsdangerous>=2.0 in /usr/local/lib/python3.10/dist-packages (from Flask) (2.2.0)\n","Requirement already satisfied: click>=8.0 in /usr/local/lib/python3.10/dist-packages (from Flask) (8.1.7)\n","Requirement already satisfied: requests in /usr/local/lib/python3.10/dist-packages (from flask-ngrok) (2.32.3)\n","Requirement already satisfied: MarkupSafe>=2.0 in /usr/local/lib/python3.10/dist-packages (from Jinja2>=3.0->Flask) (3.0.2)\n","Requirement already satisfied: charset-normalizer<4,>=2 in /usr/local/lib/python3.10/dist-packages (from requests->flask-ngrok) (3.4.0)\n","Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.10/dist-packages (from requests->flask-ngrok) (3.10)\n","Requirement already satisfied: urllib3<3,>=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests->flask-ngrok) (2.2.3)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests->flask-ngrok) (2024.8.30)\n","Downloading flask_ngrok-0.0.25-py3-none-any.whl (3.1 kB)\n","Installing collected packages: flask-ngrok\n","Successfully installed flask-ngrok-0.0.25\n","Requirement already satisfied: flask_ngrok in /usr/local/lib/python3.10/dist-packages (0.0.25)\n","Requirement already satisfied: Flask>=0.8 in /usr/local/lib/python3.10/dist-packages (from flask_ngrok) (2.2.5)\n","Requirement already satisfied: requests in /usr/local/lib/python3.10/dist-packages (from flask_ngrok) (2.32.3)\n","Requirement already satisfied: Werkzeug>=2.2.2 in /usr/local/lib/python3.10/dist-packages (from Flask>=0.8->flask_ngrok) (3.0.6)\n","Requirement already satisfied: Jinja2>=3.0 in /usr/local/lib/python3.10/dist-packages (from Flask>=0.8->flask_ngrok) (3.1.4)\n","Requirement already satisfied: itsdangerous>=2.0 in /usr/local/lib/python3.10/dist-packages (from Flask>=0.8->flask_ngrok) (2.2.0)\n","Requirement already satisfied: click>=8.0 in /usr/local/lib/python3.10/dist-packages (from Flask>=0.8->flask_ngrok) (8.1.7)\n","Requirement already satisfied: charset-normalizer<4,>=2 in /usr/local/lib/python3.10/dist-packages (from requests->flask_ngrok) (3.4.0)\n","Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.10/dist-packages (from requests->flask_ngrok) (3.10)\n","Requirement already satisfied: urllib3<3,>=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests->flask_ngrok) (2.2.3)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests->flask_ngrok) (2024.8.30)\n","Requirement already satisfied: MarkupSafe>=2.0 in /usr/local/lib/python3.10/dist-packages (from Jinja2>=3.0->Flask>=0.8->flask_ngrok) (3.0.2)\n","Collecting pyngrok\n","  Downloading pyngrok-7.2.0-py3-none-any.whl.metadata (7.4 kB)\n","Requirement already satisfied: PyYAML>=5.1 in /usr/local/lib/python3.10/dist-packages (from pyngrok) (6.0.2)\n","Downloading pyngrok-7.2.0-py3-none-any.whl (22 kB)\n","Installing collected packages: pyngrok\n","Successfully installed pyngrok-7.2.0\n","Collecting Flask-WTF\n","  Downloading flask_wtf-1.2.2-py3-none-any.whl.metadata (3.4 kB)\n","Requirement already satisfied: flask in /usr/local/lib/python3.10/dist-packages (from Flask-WTF) (2.2.5)\n","Requirement already satisfied: itsdangerous in /usr/local/lib/python3.10/dist-packages (from Flask-WTF) (2.2.0)\n","Collecting wtforms (from Flask-WTF)\n","  Downloading wtforms-3.2.1-py3-none-any.whl.metadata (5.3 kB)\n","Requirement already satisfied: Werkzeug>=2.2.2 in /usr/local/lib/python3.10/dist-packages (from flask->Flask-WTF) (3.0.6)\n","Requirement already satisfied: Jinja2>=3.0 in /usr/local/lib/python3.10/dist-packages (from flask->Flask-WTF) (3.1.4)\n","Requirement already satisfied: click>=8.0 in /usr/local/lib/python3.10/dist-packages (from flask->Flask-WTF) (8.1.7)\n","Requirement already satisfied: markupsafe in /usr/local/lib/python3.10/dist-packages (from wtforms->Flask-WTF) (3.0.2)\n","Downloading flask_wtf-1.2.2-py3-none-any.whl (12 kB)\n","Downloading wtforms-3.2.1-py3-none-any.whl (152 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m152.5/152.5 kB\u001b[0m \u001b[31m3.8 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hInstalling collected packages: wtforms, Flask-WTF\n","Successfully installed Flask-WTF-1.2.2 wtforms-3.2.1\n"]}],"source":["# Install IMDbPY if not already installed\n","# Install spaCy and download the English model if not already installed\n","\n","!pip install IMDbPY\n","!python -m spacy download en_core_web_md\n","!pip install requests\n","!pip install flask\n","!pip install Flask flask-ngrok\n","!pip install flask_ngrok\n","!pip install pyngrok\n","!pip install Flask-WTF"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":34880,"status":"ok","timestamp":1730291256839,"user":{"displayName":"Jamie Hill","userId":"10831983047187267053"},"user_tz":0},"id":"DeZdIK7SYRRc","outputId":"3fe99dd8-b9d6-406a-cc0c-8374d7ae5284"},"outputs":[{"name":"stdout","output_type":"stream","text":["How do you want to feel? (enter any mood): surprised\n","How much time do you have (in minutes)?: 120\n","Enter the language code (e.g., en for English, fr for French): en\n","Closest mood match: Thrilled - Genre ID: 53\n","\n","Recommended Movies:\n","Recent Movie (within last 10 years):\n","  - 1917 (2019)\n","  - Runtime: 119 mins\n","  - Genre: Thrilled\n","  - TMDb Rating: 7.991\n","  - Starring: George MacKay, Dean-Charles Chapman, Mark Strong\n","  - Trailer: https://www.youtube.com/watch?v=gZjQROMAh_s\n","\n","Older Movie (more than 10 years old):\n","  - The Usual Suspects (1995)\n","  - Runtime: 106 mins\n","  - Genre: Thrilled\n","  - TMDb Rating: 8.2\n","  - Starring: Stephen Baldwin, Gabriel Byrne, Benicio del Toro\n","  - Trailer: https://www.youtube.com/watch?v=byMcINu1G5M\n","\n"]}],"source":["import requests\n","import random\n","import spacy\n","from datetime import datetime\n","\n","# Load spaCy model\n","nlp = spacy.load(\"en_core_web_md\")\n","\n","# TMDb API Key\n","API_KEY = '067fd28c11279efc124bd66dcee5a58d'\n","BASE_URL = 'https://api.themoviedb.org/3'\n","\n","# Expanded mood-to-genre mapping with TMDb genre IDs\n","mood_genre_mapping = {\n","    'happy': 35,        # Comedy\n","    'thrilled': 53,     # Thriller\n","    'thoughtful': 18,   # Drama\n","    'adventurous': 12,  # Adventure\n","    'romantic': 10749,  # Romance\n","    'scared': 27,       # Horror\n","    'inspired': 99,     # Documentary\n","    'curious': 99,      # Documentary\n","    'excited': 28,      # Action\n","    'mysterious': 9648, # Mystery\n","    'fantastical': 14,  # Fantasy\n","    'magical': 16,      # Animation\n","    'nostalgic': 10751, # Family\n","    'musical': 10402,   # Music\n","    'intense': 80,      # Crime\n","    'sci-fi': 878,      # Science Fiction\n","    'historical': 36,   # History\n","    'uplifted': 10770   # TV Movie\n","}\n","\n","# Function to find closest matching mood\n","def find_closest_mood(user_mood):\n","    user_mood_doc = nlp(user_mood)\n","    closest_mood = None\n","    highest_similarity = 0\n","\n","    for mood in mood_genre_mapping.keys():\n","        mood_doc = nlp(mood)\n","        similarity = user_mood_doc.similarity(mood_doc)\n","\n","        if similarity > highest_similarity:\n","            highest_similarity = similarity\n","            closest_mood = mood\n","\n","    return closest_mood\n","\n","# Function to get movies from TMDb based on criteria\n","def get_tmdb_movies(genre_id, min_runtime, max_runtime, language, year_min=None, year_max=None):\n","    params = {\n","        'api_key': API_KEY,\n","        'with_genres': genre_id,\n","        'with_runtime.gte': min_runtime,\n","        'with_runtime.lte': max_runtime,\n","        'primary_release_date.gte': year_min,\n","        'primary_release_date.lte': year_max,\n","        'with_original_language': language,\n","        'sort_by': 'vote_average.desc',\n","        'vote_count.gte': 100,\n","        'language': 'en-US'\n","    }\n","\n","    response = requests.get(f\"{BASE_URL}/discover/movie\", params=params)\n","    movies = response.json().get('results', [])\n","\n","    # Filter movies by release year, handling None for missing release_date\n","    filtered_movies = [\n","        movie for movie in movies\n","        if movie.get('release_date') and (\n","            (year_min is None or int(movie['release_date'][:4]) >= year_min) and\n","            (year_max is None or int(movie['release_date'][:4]) <= year_max)\n","        )\n","    ]\n","    return filtered_movies[:5]  # Return top 5 movies after filtering\n","\n","# Function to get movie details including runtime\n","def get_movie_details(movie_id):\n","    params = {'api_key': API_KEY, 'language': 'en-US'}\n","    response = requests.get(f\"{BASE_URL}/movie/{movie_id}\", params=params)\n","    return response.json()\n","\n","# Function to get the trailer link for a movie\n","def get_movie_trailer(movie_id):\n","    params = {'api_key': API_KEY, 'language': 'en-US'}\n","    response = requests.get(f\"{BASE_URL}/movie/{movie_id}/videos\", params=params)\n","    videos = response.json().get('results', [])\n","    for video in videos:\n","        if video['type'] == 'Trailer' and video['site'] == 'YouTube':\n","            return f\"https://www.youtube.com/watch?v={video['key']}\"\n","    return None\n","\n","# Function to get the top-billed cast of a movie\n","def get_movie_cast(movie_id):\n","    params = {'api_key': API_KEY, 'language': 'en-US'}\n","    response = requests.get(f\"{BASE_URL}/movie/{movie_id}/credits\", params=params)\n","    cast = response.json().get('cast', [])\n","    top_cast = [actor['name'] for actor in cast[:3]]\n","    return \", \".join(top_cast) if top_cast else \"Not available\"\n","\n","def recommend_movies():\n","    user_mood = input(\"How do you want to feel? (enter any mood): \").strip().lower()\n","    time_available = int(input(\"How much time do you have (in minutes)?: \").strip())\n","    language = input(\"Enter the language code (e.g., en for English, fr for French): \").strip().lower()\n","\n","    # Find closest mood and map to genre ID\n","    closest_mood = find_closest_mood(user_mood)\n","    genre_id = mood_genre_mapping.get(closest_mood, 18)  # Default to Drama if no close match\n","\n","    print(f\"Closest mood match: {closest_mood.capitalize()} - Genre ID: {genre_id}\")\n","\n","    current_year = datetime.now().year\n","    min_runtime = max(0, time_available - 20)\n","    max_runtime = time_available\n","\n","    # Get recent and older movies with explicit year ranges\n","    recent_movies = get_tmdb_movies(genre_id, min_runtime, max_runtime, language, year_min=current_year - 10, year_max=current_year)\n","    older_movies = get_tmdb_movies(genre_id, min_runtime, max_runtime, language, year_max=current_year - 10)\n","\n","    recent_movie = random.choice(recent_movies) if recent_movies else None\n","    older_movie = random.choice(older_movies) if older_movies else None\n","\n","    print(\"\\nRecommended Movies:\")\n","    if recent_movie:\n","        recent_movie_details = get_movie_details(recent_movie['id'])\n","        recent_trailer = get_movie_trailer(recent_movie['id'])\n","        recent_cast = get_movie_cast(recent_movie['id'])\n","        print(\"Recent Movie (within last 10 years):\")\n","        print(f\"  - {recent_movie['title']} ({recent_movie['release_date'][:4]})\")\n","        print(f\"  - Runtime: {recent_movie_details.get('runtime', 'N/A')} mins\")\n","        print(f\"  - Genre: {closest_mood.capitalize()}\")\n","        print(f\"  - TMDb Rating: {recent_movie['vote_average']}\")\n","        print(f\"  - Starring: {recent_cast}\")\n","        if recent_trailer:\n","            print(f\"  - Trailer: {recent_trailer}\\n\")\n","        else:\n","            print(\"  - Trailer: Not available\\n\")\n","    else:\n","        print(\"No recent movie recommendations found.\\n\")\n","\n","    if older_movie:\n","        older_movie_details = get_movie_details(older_movie['id'])\n","        older_trailer = get_movie_trailer(older_movie['id'])\n","        older_cast = get_movie_cast(older_movie['id'])\n","        print(\"Older Movie (more than 10 years old):\")\n","        print(f\"  - {older_movie['title']} ({older_movie['release_date'][:4]})\")\n","        print(f\"  - Runtime: {older_movie_details.get('runtime', 'N/A')} mins\")\n","        print(f\"  - Genre: {closest_mood.capitalize()}\")\n","        print(f\"  - TMDb Rating: {older_movie['vote_average']}\")\n","        print(f\"  - Starring: {older_cast}\")\n","        if older_trailer:\n","            print(f\"  - Trailer: {older_trailer}\\n\")\n","        else:\n","            print(\"  - Trailer: Not available\\n\")\n","    else:\n","        print(\"No older movie recommendations found.\")\n","\n","# Run the recommendation function\n","recommend_movies()\n"]},{"cell_type":"markdown","metadata":{"id":"iZBK-UwdUHV9"},"source":["to flask and beyond"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Zp5XWeuyag0H","outputId":"48180772-01a2-4c41-ce2f-98cbcd928830"},"outputs":[{"output_type":"stream","name":"stdout","text":["Ngrok tunnel URL: NgrokTunnel: \"https://a901-35-231-230-135.ngrok-free.app\" -> \"http://localhost:5000\"\n"," * Serving Flask app '__main__'\n"," * Debug mode: off\n"]},{"output_type":"stream","name":"stderr","text":["INFO:werkzeug:\u001b[31m\u001b[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.\u001b[0m\n"," * Running on http://127.0.0.1:5000\n","INFO:werkzeug:\u001b[33mPress CTRL+C to quit\u001b[0m\n"]},{"output_type":"stream","name":"stdout","text":[" * Running on http://a901-35-231-230-135.ngrok-free.app\n"," * Traffic stats available on http://127.0.0.1:4040\n"]},{"output_type":"stream","name":"stderr","text":["INFO:werkzeug:127.0.0.1 - - [31/Oct/2024 07:35:28] \"GET / HTTP/1.1\" 200 -\n","INFO:werkzeug:127.0.0.1 - - [31/Oct/2024 07:35:29] \"\u001b[33mGET /favicon.ico HTTP/1.1\u001b[0m\" 404 -\n"]},{"output_type":"stream","name":"stdout","text":["User mood 'romantic' compared to 'happy': similarity = 0.3658038201303511\n","User mood 'romantic' compared to 'thrilled': similarity = 0.3610188226164166\n","User mood 'romantic' compared to 'thoughtful': similarity = 0.505510865327563\n","User mood 'romantic' compared to 'adventurous': similarity = 0.6405774708050862\n","User mood 'romantic' compared to 'sad': similarity = 0.24608744258640283\n","User mood 'romantic' compared to 'melancholy': similarity = 0.3426629196668419\n","User mood 'romantic' compared to 'excited': similarity = 0.2899185357872624\n","User mood 'romantic' compared to 'calm': similarity = 0.2571838951740284\n","User mood 'romantic' compared to 'scared': similarity = 0.177452278441973\n","User mood 'romantic' compared to 'romantic': similarity = 1.0\n","User mood 'romantic' compared to 'dramatic': similarity = 0.4963319785944891\n","User mood 'romantic' compared to 'funny': similarity = 0.4322027099143312\n","User mood 'romantic' compared to 'inspired': similarity = 0.47371157830500105\n","Closest mood found: romantic with similarity 1.0\n","User mood 'romantic' compared to 'happy': similarity = 0.3658038201303511\n","User mood 'romantic' compared to 'thrilled': similarity = 0.3610188226164166\n","User mood 'romantic' compared to 'thoughtful': similarity = 0.505510865327563\n","User mood 'romantic' compared to 'adventurous': similarity = 0.6405774708050862\n","User mood 'romantic' compared to 'sad': similarity = 0.24608744258640283\n","User mood 'romantic' compared to 'melancholy': similarity = 0.3426629196668419\n","User mood 'romantic' compared to 'excited': similarity = 0.2899185357872624\n","User mood 'romantic' compared to 'calm': similarity = 0.2571838951740284\n","User mood 'romantic' compared to 'scared': similarity = 0.177452278441973\n","User mood 'romantic' compared to 'romantic': similarity = 1.0\n","User mood 'romantic' compared to 'dramatic': similarity = 0.4963319785944891\n","User mood 'romantic' compared to 'funny': similarity = 0.4322027099143312\n","User mood 'romantic' compared to 'inspired': similarity = 0.47371157830500105\n","Closest mood found: romantic with similarity 1.0\n"]},{"output_type":"stream","name":"stderr","text":["INFO:werkzeug:127.0.0.1 - - [31/Oct/2024 07:35:39] \"POST /recommend HTTP/1.1\" 200 -\n","INFO:werkzeug:127.0.0.1 - - [31/Oct/2024 07:35:39] \"POST /recommend HTTP/1.1\" 200 -\n"]}],"source":["from flask import Flask, request, render_template\n","from flask_ngrok import run_with_ngrok\n","import requests\n","import random\n","import spacy\n","from datetime import datetime\n","from pyngrok import ngrok\n","import os\n","\n","# Load spaCy model\n","nlp = spacy.load(\"en_core_web_md\")\n","\n","# Initialize Flask app\n","app = Flask(__name__, template_folder='/content/drive/MyDrive/ColabNotebooks/Movie_recommender/templates')  # Adjust the path as necessary\n","ngrok.set_auth_token(os.getenv(\"NGROK_AUTH_TOKEN\", \"2o4pfmzyiwmBZcY4vhwQiYsOiJS_FsuQB2nueaQ863GcU2ya\"))\n","run_with_ngrok(app)  # Integrate ngrok\n","public_url = ngrok.connect(5000)\n","print(\"Ngrok tunnel URL:\", public_url)\n","\n","# TMDb API Key and Base URL\n","API_KEY = '067fd28c11279efc124bd66dcee5a58d'\n","BASE_URL = 'https://api.themoviedb.org/3'\n","\n","# Expanded mood-to-genre mapping with more options\n","mood_genre_mapping = {\n","    'happy': 35,\n","    'thrilled': 53,\n","    'thoughtful': 18,\n","    'adventurous': 12,\n","    'sad': 18,\n","    'melancholy': 18,\n","    'excited': 28,\n","    'calm': 10751,\n","    'scared': 27,\n","    'romantic': 10749,\n","    'dramatic': 18,\n","    'funny': 35,\n","    'inspired': 18\n","}\n","\n","# Improved function to find the closest mood\n","def find_closest_mood(user_mood):\n","    user_mood_doc = nlp(user_mood)\n","    closest_mood = None\n","    highest_similarity = -1\n","\n","    for mood in mood_genre_mapping.keys():\n","        mood_doc = nlp(mood)\n","        similarity = user_mood_doc.similarity(mood_doc)\n","        print(f\"User mood '{user_mood}' compared to '{mood}': similarity = {similarity}\")\n","\n","        if similarity > highest_similarity:\n","            closest_mood = mood\n","            highest_similarity = similarity\n","\n","    if highest_similarity < 0.5:\n","        print(f\"Low similarity ({highest_similarity}) for mood '{user_mood}'; defaulting to 'thoughtful'\")\n","        closest_mood = 'thoughtful'\n","\n","    print(f\"Closest mood found: {closest_mood} with similarity {highest_similarity}\")\n","    return closest_mood\n","\n","# Helper function to get detailed movie info, including trailer, cast, runtime, and streaming services\n","def get_movie_details(movie_id, country_code='US'):\n","    url = f\"{BASE_URL}/movie/{movie_id}\"\n","    params = {'api_key': API_KEY, 'append_to_response': 'videos,credits,watch/providers'}\n","    response = requests.get(url, params=params)\n","    if response.status_code == 200:\n","        data = response.json()\n","\n","        trailer_url = None\n","        for video in data['videos']['results']:\n","            if video['type'] == 'Trailer' and video['site'] == 'YouTube':\n","                trailer_url = f\"https://www.youtube.com/watch?v={video['key']}\"\n","                break\n","\n","        cast = ', '.join([member['name'] for member in data['credits']['cast'][:5]])\n","        streaming_services = []\n","        providers = data['watch/providers']['results'].get(country_code)\n","        if providers and 'flatrate' in providers:\n","            streaming_services = [provider['provider_name'] for provider in providers['flatrate']]\n","\n","        return {\n","            'title': data['title'],\n","            'release_date': data.get('release_date', 'N/A'),\n","            'vote_average': data['vote_average'],\n","            'runtime': data.get('runtime', 'N/A'),\n","            'trailer_url': trailer_url,\n","            'cast': cast,\n","            'streaming_services': ', '.join(streaming_services) if streaming_services else 'Not available for streaming'\n","        }\n","    else:\n","        print(f\"Error retrieving movie details: {response.status_code} - {response.text}\")\n","        return None\n","\n","# Helper function to get movies from TMDB API\n","def get_tmdb_movies(genre_id, min_runtime, max_runtime, language, year_min=None, year_max=None):\n","    url = f\"{BASE_URL}/discover/movie\"\n","    params = {\n","        'api_key': API_KEY,\n","        'with_genres': genre_id,\n","        'with_original_language': language,\n","        'with_runtime.gte': min_runtime,\n","        'with_runtime.lte': max_runtime,\n","        'sort_by': 'popularity.desc',\n","        'vote_average.gte': 5,\n","        'include_adult': False,\n","    }\n","\n","    if year_min:\n","        params['primary_release_date.gte'] = f\"{year_min}-01-01\"\n","    if year_max:\n","        params['primary_release_date.lte'] = f\"{year_max}-12-31\"\n","\n","    response = requests.get(url, params=params)\n","    if response.status_code == 200:\n","        movies = response.json().get('results', [])\n","        return [get_movie_details(movie['id']) for movie in movies if get_movie_details(movie['id']) is not None]\n","    else:\n","        print(f\"Error: {response.status_code} - {response.text}\")\n","        return []\n","\n","# Define route for the homepage\n","@app.route('/')\n","def home():\n","    return render_template('home.html')\n","\n","# Define route for displaying recommendations\n","@app.route('/recommend', methods=['POST'])\n","def recommend():\n","    user_mood = request.form.get('mood').strip().lower()\n","    time_available = int(request.form.get('time_available').strip())\n","    language = request.form.get('language').strip().lower()\n","\n","    closest_mood = find_closest_mood(user_mood)\n","    genre_id = mood_genre_mapping.get(closest_mood, 18)\n","\n","    min_runtime = max(0, time_available - 20)\n","    max_runtime = time_available\n","    current_year = datetime.now().year\n","\n","    recent_movies = get_tmdb_movies(genre_id, min_runtime, max_runtime, language, year_min=current_year - 10, year_max=current_year)\n","    older_movies = get_tmdb_movies(genre_id, min_runtime, max_runtime, language, year_max=current_year - 10)\n","\n","    recommendations = [\n","        (random.choice(recent_movies) if recent_movies else None, \"Recent Movie (within last 10 years)\"),\n","        (random.choice(older_movies) if older_movies else None, \"Older Movie (more than 10 years old)\")\n","    ]\n","\n","    return render_template('recommendations.html', mood=closest_mood.capitalize(), recommendations=recommendations)\n","\n","if __name__ == '__main__':\n","    app.run()\n"]},{"cell_type":"code","source":["%%writefile /content/drive/MyDrive/ColabNotebooks/Movie_recommender/templates/home.html\n","<!DOCTYPE html>\n","<html lang=\"en\">\n","<head>\n","    <meta charset=\"UTF-8\">\n","    <title>Movie Recommender</title>\n","    <style>\n","        body { font-family: Arial, sans-serif; background-color: #f8f9fa; color: #333; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }\n","        .container { background-color: #fff; padding: 20px 40px; border-radius: 10px; box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1); text-align: center; max-width: 400px; }\n","        h1 { color: #007bff; font-size: 24px; margin-bottom: 20px; }\n","        label { font-weight: bold; margin-top: 10px; display: block; }\n","        input[type=\"text\"], input[type=\"number\"] { width: 100%; padding: 10px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc; margin-bottom: 15px; }\n","        button { background-color: #007bff; color: white; border: none; padding: 10px 20px; font-size: 16px; cursor: pointer; border-radius: 5px; }\n","        button:hover { background-color: #0056b3; }\n","    </style>\n","</head>\n","<body>\n","    <div class=\"container\">\n","        <h1>Find Your Movie</h1>\n","        <form action=\"/recommend\" method=\"post\">\n","            <label for=\"mood\">How do you want to feel?</label>\n","            <input type=\"text\" id=\"mood\" name=\"mood\" required>\n","\n","            <label for=\"time_available\">How much time do you have (in minutes)?</label>\n","            <input type=\"number\" id=\"time_available\" name=\"time_available\" required>\n","\n","            <label for=\"language\">Language (e.g., en for English):</label>\n","            <input type=\"text\" id=\"language\" name=\"language\" required>\n","\n","            <button type=\"submit\">Get Recommendation</button>\n","        </form>\n","    </div>\n","</body>\n","</html>\n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"GwVLjzQGdvYU","executionInfo":{"status":"ok","timestamp":1730359600028,"user_tz":0,"elapsed":293,"user":{"displayName":"Jamie Hill","userId":"10831983047187267053"}},"outputId":"ce08964b-4f0a-47c4-d6dc-d9d44d2d21d6"},"execution_count":1,"outputs":[{"output_type":"stream","name":"stdout","text":["Writing /content/drive/MyDrive/ColabNotebooks/Movie_recommender/templates/home.html\n"]}]},{"cell_type":"code","source":["%%writefile /content/drive/MyDrive/ColabNotebooks/Movie_recommender/templates/recommendations.html\n","<!DOCTYPE html>\n","<html lang=\"en\">\n","<head>\n","    <meta charset=\"UTF-8\">\n","    <title>Movie Recommendation Result</title>\n","    <style>\n","        body { font-family: Arial, sans-serif; background-color: #f8f9fa; color: #333; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }\n","        .container { background-color: #fff; padding: 20px 40px; border-radius: 10px; box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1); max-width: 500px; }\n","        h1 { color: #007bff; font-size: 24px; text-align: center; margin-bottom: 20px; }\n","        .movie { margin-bottom: 20px; padding: 15px; border-radius: 5px; background-color: #f1f1f1; box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1); }\n","        h2 { color: #333; font-size: 20px; margin: 10px 0; }\n","        p { margin: 5px 0; }\n","    </style>\n","</head>\n","<body>\n","    <div class=\"container\">\n","        <h1>Recommended Movies for Feeling {{ mood }}</h1>\n","\n","        {% for movie, label in recommendations %}\n","        <div class=\"movie\">\n","            <h2>{{ label }}:</h2>\n","            <p><strong>Title:</strong> {{ movie['title'] }} ({{ movie['release_date'][:4] }})</p>\n","            <p><strong>Rating:</strong> {{ movie['vote_average'] }}</p>\n","            <p><strong>Runtime:</strong> {{ movie['runtime'] }} mins</p>\n","            <p><strong>Cast:</strong> {{ movie['cast'] }}</p>\n","            <p><strong>Streaming Services:</strong> {{ movie['streaming_services'] }}</p>\n","            <p><strong>Trailer:</strong> <a href=\"{{ movie['trailer_url'] }}\" target=\"_blank\">Watch Trailer</a></p>\n","        </div>\n","        {% else %}\n","        <p>No recommendations available.</p>\n","        {% endfor %}\n","    </div>\n","</body>\n","</html>\n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"xSCxB_wZeUDP","executionInfo":{"status":"ok","timestamp":1730359676135,"user_tz":0,"elapsed":257,"user":{"displayName":"Jamie Hill","userId":"10831983047187267053"}},"outputId":"1d105d05-6a70-40df-8f78-44fe78a2be43"},"execution_count":2,"outputs":[{"output_type":"stream","name":"stdout","text":["Writing /content/drive/MyDrive/ColabNotebooks/Movie_recommender/templates/recommendations.html\n"]}]},{"cell_type":"code","source":["%%writefile /content/drive/MyDrive/ColabNotebooks/Movie_recommender/requirements.txt\n","Flask\n","flask-ngrok\n","requests\n","spacy\n","pyngrok\n"],"metadata":{"id":"BYZeM2hO1RrC","executionInfo":{"status":"ok","timestamp":1730365698946,"user_tz":0,"elapsed":321,"user":{"displayName":"Jamie Hill","userId":"10831983047187267053"}},"outputId":"cdc0979d-9ac3-4263-e8b2-3d3c32cbf978","colab":{"base_uri":"https://localhost:8080/"}},"execution_count":8,"outputs":[{"output_type":"stream","name":"stdout","text":["Writing /content/drive/MyDrive/ColabNotebooks/Movie_recommender/requirements.txt\n"]}]}],"metadata":{"colab":{"provenance":[],"mount_file_id":"1gYEgL_mwPFxYsdTdLh-hAfg82sklLgXk","authorship_tag":"ABX9TyOsW921/bwG/0FV327PwQ5h"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}